<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Management System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    th { background-color: #007bff; color: white; }
    .btn-delete { background-color: #dc3545; color: white; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">User Managment System</a>
      <div class="d-flex text-white">
        <span class="me-3">üëã Welcome, <%= user.username %></span>
        <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
      </div>
    </div>
  </nav>


  <div class="container">
    <div class="text-center mb-4">
      <h2>üë• Manage Users</h2>
      <p class="text-muted">Add, update, search, or delete users below</p>
    </div>

    <!-- Search Bar -->
    <div class="input-group mb-4">
      <input id="searchInput" type="text" class="form-control" placeholder="Search by name or email...">
    </div>

    <!-- User Table -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white d-flex justify-content-between">
        <h5 class="mb-0">Current Users</h5>
        <button class="btn btn-light btn-sm" id="sortBtn">Sort by Name</button>
      </div>
      <div class="card-body">
        <table class="table table-bordered table-hover text-center align-middle" id="userTable">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Age</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% data.forEach(user => { %>
              <tr>
                <td><%= user.userUniqueId %></td>
                <td><%= user.userName %></td>
                <td><%= user.userEmail %></td>
                <td><%= user.userAge %></td>
                <td>
                  <form action="/delete" method="post" class="d-inline deleteForm">
                    <input type="hidden" name="userUniqueId" value="<%= user.userUniqueId %>">
                    <button type="submit" class="btn btn-sm btn-delete">üóë Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Add User -->
    <div class="card p-4 mb-4">
      <h4 class="text-success mb-3">‚ûï Add User</h4>
      <form action="/" method="post" class="row g-3">
        <div class="col-md-3"><input name="userUniqueId" class="form-control" placeholder="User ID" required></div>
        <div class="col-md-3"><input name="userName" class="form-control" placeholder="Name" required></div>
        <div class="col-md-3"><input type="email" name="userEmail" class="form-control" placeholder="Email" required></div>
        <div class="col-md-2"><input type="number" name="userAge" class="form-control" placeholder="Age" required></div>
        <div class="col-md-1 d-grid"><button class="btn btn-success">Add</button></div>
      </form>
    </div>

    <!-- Update User -->
    <div class="card p-4">
      <h4 class="text-warning mb-3">‚úèÔ∏è Update User</h4>
      <form action="/update" method="post" class="row g-3">
        <div class="col-md-3"><input name="userUniqueId" class="form-control" placeholder="User ID" required></div>
        <div class="col-md-3"><input name="userName" class="form-control" placeholder="New Name"></div>
        <div class="col-md-3"><input type="email" name="userEmail" class="form-control" placeholder="New Email"></div>
        <div class="col-md-2"><input type="number" name="userAge" class="form-control" placeholder="New Age"></div>
        <div class="col-md-1 d-grid"><button class="btn btn-warning">Update</button></div>
      </form>
    </div>
  </div>

  <!-- JS -->
  <script>
    // Search filter
    document.getElementById("searchInput").addEventListener("input", function() {
      const term = this.value.toLowerCase();
      document.querySelectorAll("#userTable tbody tr").forEach(row => {
        const name = row.children[1].textContent.toLowerCase();
        const email = row.children[2].textContent.toLowerCase();
        row.style.display = name.includes(term) || email.includes(term) ? "" : "none";
      });
    });

    // Delete confirmation
    document.querySelectorAll(".deleteForm").forEach(form => {
      form.addEventListener("submit", e => {
        if (!confirm("Are you sure you want to delete this user?")) e.preventDefault();
      });
    });

    // Sort users by name
    let asc = true;
    document.getElementById("sortBtn").addEventListener("click", () => {
      const tbody = document.querySelector("#userTable tbody");
      const rows = Array.from(tbody.querySelectorAll("tr"));
      rows.sort((a, b) => {
        const A = a.children[1].textContent.toLowerCase();
        const B = b.children[1].textContent.toLowerCase();
        return asc ? A.localeCompare(B) : B.localeCompare(A);
      });
      rows.forEach(row => tbody.appendChild(row));
      asc = !asc;
    });
  </script>
</body>
</html>
